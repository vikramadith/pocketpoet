<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="css/jquery.mobile-1.4.3.css" />
<link rel="stylesheet" href="css/main.css" />
<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/jquery.mobile.custom.min.js"></script>
<script>
	$(function() 
	{
		$("[data-role='navbar']").navbar();
		$("[data-role='header'], [data-role='footer']").toolbar();
		$("#nav1").hide();
	});

	$(document).on("pagecontainershow", function() 
	{
		ScaleContentToDevice();
	});

	function onNav(location) 
	{
		console.log("onNav");
		
		if(location == "#home")
		{
			$.mobile.changePage(location, {transition: "slideup"});	
			$("#nav1").hide();
			$("#nav2").show();			
		}
		else
		{
			$.mobile.changePage(location, {transition: "slidedown"});	
			$("#nav2").hide();
			$("#nav1").show();
		}
	}

	function ScaleContentToDevice() 
	{
		scroll(0, 0);
		var content = $.mobile.getScreenHeight()
				- $(".ui-header").outerHeight() - $(".ui-footer").outerHeight()
				- $(".ui-content").outerHeight() + $(".ui-content").height();
		$(".ui-content").height(content);
		
	}
	
	var scansion = "";

	function scansionControlClick(event)
	{
		var scansionCtrl = $(event.target).parent()[0].id;
		
		$("#" + scansionCtrl).css("border-color", "#3388CC");
		
		setTimeout(function()
				{
					$("#" + scansionCtrl).css("border-color", "rgba(255, 255, 255, 0)");					
				}, 200);
		
		if(scansionCtrl == "scansionAddUnstressed")
		{
			scansion += "*";
		}
		else
		{
			scansion += "<span class='scansionTextS'>/</span>";
		}
		
		$("#scansionTxt").html(scansion);
	}
	
	function doneClick()
	{
		onNav("#home");
	}	

	var isSearchingRhyme = false;
	var isSearchingMeaning = false;
	var isSearchingSyllables = false;
	var isSearchingScansion = false;
	var words = [];
	
	function searchClick()
	{
		words = [];
		
		checkFields();
		
		if(isSearchingRhyme)
		{
			fetchRhymes();
		}
		
		
		
	}
	
	function checkFields()
	{
		if($("#rhymeTI").val().length > 0)
		{
			console.log("1");
			isSearchingRhyme = true;
		}
		if($("#meaningTI").val().length > 0)
		{console.log("2");
			isSearchingMeaning = true;
		}
		if($("#syllablesTI").val().length > 0)
		{console.log("3");
			isSearchingSyllables = true;
		}
		if($("#scansionTxt").text() != "--")
		{console.log("4");
			isSearchingScansion = true;
		}
	}
	
	function fetchRhymes()
	{
		$.ajax(
				{
					url: "http://rhymebrain.com/talk?function=getRhymes&word=" + $("#rhymeTI").val()
				})
				.done(fetchRhymesHandler);
	}
	
	function fetchRhymesHandler(data)
	{
		for(var dataIndex = 0; dataIndex < data.length; dataIndex++)
		{
			if(data[dataIndex].score != "300")
			{
				continue;
			}
			if(isSearchingSyllables)
			{
				if(data[dataIndex].syllables != $("#syllablesTI").val())
				{
					continue;
				}
			}
			
			words.push(data[dataIndex].word);
		}
		
		displayWords();
	}
	
	function displayWords()
	{
		var listHTML = "";
		
		for(var wordIndex = 0; wordIndex < words.length; wordIndex++)
		{
			listHTML += "<li>" + words[wordIndex] + "</li>";
		}		

		$("#wordList").html(listHTML);
		$("#wordList").listview("refresh");
	}
	
</script>

</head>

<body>

	<div data-role="header" data-position="fixed" data-theme="a"
		class="headz" data-tap-toggle="false">
		<div class="headzTxt">Pocket Poet</div>
		<div data-role="navbar">
			<ul>
				<li>
					<div class="filterBox filterBoxRhyme" onclick="onNav('#rhyme');">Rhyme</div>
				</li>
				<li>
					<div class="filterBox filterBoxMeaning"
						onclick="onNav('#meaning');">Meaning</div>
				</li>
				<li>
					<div class="filterBox filterBoxSyllables"
						onclick="onNav('#syllables');">Syllables</div>
				</li>
				<li>
					<div class="filterBox filterBoxScansion"
						onclick="onNav('#scansion');">Scansion</div>
				</li>
			</ul>
		</div>
	</div>

	<div data-role="page" id="home" data-title="Home" class="homePage">

		<div data-role="main" class="ui-content">
			<div class="fieldPage">
				<ul id="wordList" data-role="listview">
				</ul>
			</div>
		</div>
		<!-- /content -->

	</div>
	<!-- /page -->

	<div data-role="page" id="rhyme" data-title="rhyme" class="rhymePage">

		<div data-role="main" class="ui-content">
			<div class="fieldPage">
				<br /> <span class="fieldTitle">Word to rhyme with:</span> <input
					data-clear-btn="true" name="rhymeTI" id="rhymeTI" value=""
					type="text">

			</div>
		</div>
		<!-- /content -->

	</div>
	<!-- /page -->



	<div data-role="page" id="meaning" data-title="rhyme"
		class="meaningPage">

		<div data-role="main" class="ui-content">
			<div class="fieldPage">

				<br /> <span class="fieldTitle">Synonymous with:</span> <input
					name="meaningTI" id="meaningTI" value="" type="text">
			</div>
		</div>
		<!-- /content -->


	</div>
	<!-- /page -->

	<div data-role="page" id="syllables" data-title="Home"
		class="syllablesPage">

		<div data-role="main" class="ui-content">
			<div class="fieldPage">

				<br /> <span class="fieldTitle">Number of syllables:</span> <input
					name="syllablesTI" id="syllablesTI" value="" type="number">
			</div>
		</div>
		<!-- /content -->


	</div>
	<!-- /page -->

	<div data-role="page" id="scansion" data-title="rhyme"
		class="scansionPage">

		<div data-role="main" class="ui-content">
			<div class="fieldPage">

				<br /> <span class="fieldTitle">Ending stress pattern:</span> <br />
				<div id="scansionTxt" class="scansionText">--</div>
				<br />
				<br /> Tap below to add stressed or unstressed syllables
				<div class="scansionControls">
					<div id="scansionAddUnstressed" class="scansionGrid1"
						onclick="scansionControlClick(event);">
						<div class="scansionSymbol">*</div>
						<div class="scansionTxtBox">Unstressed</div>
					</div>
					<div id="scansionAddStressed" class="scansionGrid2"
						onclick="scansionControlClick(event);">
						<div class="scansionSymbolS">/</div>
						<div class="scansionTxtBoxS">Stressed</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /content -->


	</div>
	<!-- /page -->

	<div data-role="footer" data-position="fixed" data-theme="b"
		data-tap-toggle="false">

		<!-- 		<div data-role="navbar" data-iconpos="left"> -->
		<!-- 			<ul id="fieldNav"> -->
		<!-- 				<li><a href="#" data-icon="delete"><span class="navBtn">Clear</span></a></li> -->
		<!-- 				<li><a href="#" data-icon="check" onclick="doneClick()"><span class="navBtn">Done</span></a></li> -->
		<!-- 			</ul> -->
		<!-- 			<ul id="mainNav"> -->
		<!-- 				<li><a href="#" data-icon="search" onclick="doneClick()"><span class="navBtn">Search</span></a></li> -->
		<!-- 			</ul> -->
		<!-- 		</div> -->

		<div id="nav1" data-role="navbar" data-iconpos="left">
			<ul>
				<li><a href="#" data-icon="delete"><span class="navBtn">Clear</span></a></li>
				<li><a href="#" data-icon="check" onclick="doneClick()"><span
						class="navBtn">Done</span></a></li>
			</ul>
		</div>

		<div id="nav2" data-role="navbar" data-iconpos="left">
			<ul>
				<li><a href="#" data-icon="search" onclick="searchClick();"><span
						class="navBtn">Search</span></a></li>
			</ul>
		</div>

	</div>

</body>
</html>